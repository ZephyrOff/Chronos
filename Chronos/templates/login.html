{% extends "layout/base.html" %}

{% block title %}Chronos - Connexion{% endblock %}

{% block content %}
<div class="login-container flex items-center justify-center min-h-screen bg-gray-900">
    <div class="w-full max-w-md p-8 space-y-6 bg-gray-800 rounded-lg shadow-lg">
        <div class="text-center">
            <img src="{{ url_for('static', filename='chronos.png') }}" alt="Chronos Logo" class="w-20 h-20 mx-auto">
            <h2 class="mt-6 text-3xl font-extrabold text-white">Connectez-vous à votre compte</h2>
        </div>
        <form id="login-form" class="space-y-6">
            <div>
                <label for="username" class="text-sm font-medium text-gray-300">Nom d'utilisateur</label>
                <input type="text" id="username" name="username" required 
                       class="w-full px-3 py-2 mt-1 text-gray-200 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div>
                <label for="password" class="text-sm font-medium text-gray-300">Mot de passe</label>
                <input type="password" id="password" name="password" required 
                       class="w-full px-3 py-2 mt-1 text-gray-200 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
            </div>
            <div>
                <button type="submit" 
                        class="w-full px-4 py-2 font-semibold text-white bg-blue-600 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-800 focus:ring-blue-500">
                    Se connecter
                </button>
            </div>
        </form>
        <div id="error-message" class="hidden p-3 mt-4 text-sm text-red-400 bg-red-900 border border-red-400 rounded-md">
            Identifiants invalides. Veuillez réessayer.
        </div>
    </div>
</div>

<script>
    // Hide sidebar and adjust content margin for the login page
    document.addEventListener('DOMContentLoaded', function() {
        const sidebar = document.querySelector('.sidebar');
        if (sidebar) {
            sidebar.style.display = 'none';
        }
        // Since the main content is now the login container, we don't need to adjust margins.
    });

    document.getElementById('login-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const username = document.getElementById('username').value;
        const password = document.getElementById('password').value;
        const errorMessage = document.getElementById('error-message');

        errorMessage.classList.add('hidden');

        const response = await fetch('{{ url_for("auth_bp.login") }}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ username, password })
        });

        if (response.ok) {
            window.location.href = '{{ url_for("task_manager.index") }}';
        } else {
            errorMessage.classList.remove('hidden');
        }
    });
</script>
{% endblock %}